{% extends "auctions/layout.html" %}

{% block body %}

    <div id="message"></div>
    <center>
        <form action="{% url 'recycle_deposit' %}" enctype="multipart/form-data" method="POST">
            {% csrf_token %}
            <h1>Recycling Deposit Near You</h1>
            <div style="width:50%;" class="input-group mb-3">
              <label class="input-group-text" for="inputGroupFile02">Image of Deposit</label>
              {{ form.image }}
            </div>
            <div style="width:50%;" class="input-group">
              <span class="input-group-text">Description</span>
              {{ form.description }}
            </div>
            <div style="width:50%" class="input-group mb-3">
              <button class="btn btn-outline-secondary" type="button" id="findLocation">Select Current Location</button>
                {{ form.location }}
            </div>
            <br>
            <input type="submit" class="btn btn-primary" value="Submit Recycling Deposit">
        </form>
    </center>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const location = document.getElementById('findLocation');
            location.addEventListener('click', function() {
                initMap();
            });
        });


    function initMap() {
        const location = document.getElementById('findLocation');
        const success = (position) => {
            console.log(position);
            const latitude = position.coords.latitude;
            const longitude = position.coords.longitude;
            const coordinates = `${latitude},${longitude}`;
            console.log(coordinates);
            const accuracy = position.coords.accuracy;
            console.log(accuracy);
            const new_location = document.getElementById('id_location');
            new_location.value = coordinates;
            location.remove()
        }
        const error = () => {
            console.log("User did not provide location");
            location.textContent = "Location was not provided";
        }

        navigator.geolocation.getCurrentPosition(success, error, {enableHighAccuracy: true});
    }

    </script>

{% endblock %}
